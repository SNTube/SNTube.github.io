const CountdownTimer=(()=>{const e={targetDate:"",targetName:"",units:{day:{text:"今日",divider:1,unit:"小时"},week:{text:"本周",divider:24,unit:"天"},month:{text:"本月",divider:24,unit:"天"},year:{text:"本年",divider:24,unit:"天"}},countdownText:{future:"距离",today:""}};function t(e){return`${e.getFullYear()}-${(e.getMonth()+1).toString().padStart(2,"0")}-${e.getDate().toString().padStart(2,"0")}`}function n(){const e=new Date;function n(n){let a=new Date(e);for(let e=0;e<60;e++)if(a.setDate(a.getDate()+1),"solar"===n){const e=Solar.fromDate(a).getFestivals();if(e.length>0)return e.slice(0,1).map((e=>({name:e,type:n,date:t(a),timestamp:a.getTime()})))[0]}else if("lunar"===n){const e=Lunar.fromDate(a).getFestivals();if(e.length>0)return e.slice(0,1).map((e=>({name:e,type:n,date:t(a),timestamp:a.getTime()})))[0]}}const a=Solar.fromDate(e),i=Lunar.fromDate(e);let o=a.getFestivals().slice(0,1).map((n=>({name:n,type:"solar",date:t(e),timestamp:e.getTime()}))),r=i.getFestivals().slice(0,1).map((n=>({name:n,type:"lunar",date:t(e),timestamp:e.getTime()})));if(0===o.length){const e=n("solar");o=e?[e]:[]}if(0===r.length){const e=n("lunar");r=e?[e]:[]}const s=i.getNextJieQi(),c={name:s.getName(),type:"jieqi",date:s.getSolar().toYmd(),timestamp:new Date(s.getSolar().getYear(),s.getSolar().getMonth()-1,s.getSolar().getDay()).getTime()},l=[...o,...r,c].filter((e=>void 0!==e)),d=new Date(e.getFullYear(),e.getMonth(),e.getDate()).getTime(),m=d+864e5-1,g=l.find((e=>e.timestamp>=d&&e.timestamp<=m));return g||l.filter((t=>t.timestamp>e.getTime())).sort(((e,t)=>e.timestamp-t.timestamp))[0]}function a(t){const n=new Date;if("day"===t){const a=n.getHours();return{name:e.units[t].text,remaining:24-a,percentage:(a/24*100).toFixed(2),unit:e.units[t].unit}}let a=new Date(n),i=new Date(n);const o=new Date(n.getFullYear(),n.getMonth(),n.getDate()),r=n.getDay()||7;switch(t){case"week":a=new Date(o.setDate(o.getDate()-(r-1))),i=new Date(a),i.setDate(a.getDate()+6);break;case"month":a=o,a.setDate(a.getDate()+1),i=new Date(a.getFullYear(),a.getMonth()+1,0);break;case"year":a=o,a.setDate(a.getDate()+1),i=new Date(a.getFullYear(),11,31)}let s,c,l;a.setHours(0,0,0,0),i.setHours(23,59,59,999),"week"===t?(c=7,l=r,s=7-r):"month"===t?(c=new Date(n.getFullYear(),n.getMonth()+1,0).getDate(),l=n.getDate(),s=Math.floor((i-a)/864e5)+1):"year"===t&&(c=(new Date(n.getFullYear(),11,31)-new Date(n.getFullYear(),0,1))/864e5+1,l=(o-new Date(n.getFullYear(),0,1))/864e5+1,s=Math.floor((i-a)/864e5)+1);const d=l/c*100;return{name:e.units[t].text,remaining:s,percentage:d.toFixed(2),unit:e.units[t].unit}}function i(){const t=["eventName","eventDate","daysUntil","countRight","countdownText"].map((e=>document.getElementById(e)));if(t.some((e=>!e)))return;const[i,o,r,s,c]=t;if(e.targetDate&&e.targetName){const t=new Date(e.targetDate).getTime();nextFestival={name:e.targetName,date:e.targetDate,timestamp:t}}else nextFestival=n();const l=Object.keys(e.units).reduce(((e,t)=>({...e,[t]:a(t)})),{});if(nextFestival){const t=Math.ceil((nextFestival.timestamp-Date.now())/864e5),n=0===t;c.textContent=n?e.countdownText.today:e.countdownText.future,i.textContent=nextFestival.name,o.textContent=nextFestival.date,r.textContent=n?"今天":t}s.innerHTML=Object.entries(l).map((([e,t])=>`\n        <div class="cd-count-item">\n          <div class="cd-item-name">${t.name}</div>\n          <div class="cd-item-progress">\n            <div class="cd-progress-bar" style="width: ${t.percentage}%; opacity: ${t.percentage/100}"></div>\n            <span class="cd-percentage ${t.percentage>=46?"cd-many":""}">${t.percentage}%</span>\n            <span class="cd-remaining ${t.percentage>=60?"cd-many":""}">\n              <span class="cd-tip">还剩</span>${t.remaining}<span class="cd-tip">${t.unit}</span>\n            </span>\n          </div>\n        </div>\n      `)).join("")}let o;const r=()=>{!function(){const e=document.createElement("style");e.textContent='\n            .card-countdown .item-content {\n                display: flex;\n            }\n            .cd-count-left {\n                position: relative;\n                display: flex;\n                flex-direction: column;\n                margin-right: 0.8rem;\n                line-height: 1.5;\n                align-items: center;\n                justify-content: center;\n                min-height: 120px;\n            }\n            .cd-count-left .cd-text {\n                font-size: 14px;\n                display: block;\n            }\n            .cd-count-left .cd-name {\n                font-weight: bold;\n                font-size: 18px;\n            }\n            .cd-count-left .cd-time {\n                font-size: 30px;\n                font-weight: bold;\n                color: var(--anzhiyu-main);\n            }\n            .cd-count-left .cd-date {\n                font-size: 12px;\n                opacity: 0.6;\n            }\n            .cd-count-left::after {\n                content: "";\n                position: absolute;\n                right: -0.8rem;\n                width: 2px;\n                height: 80%;\n                background-color: var(--anzhiyu-main);\n                opacity: 0.5;\n            }\n            .cd-count-right {\n                flex: 1;\n                margin-left: .8rem;\n                display: flex;\n                flex-direction: column;\n                justify-content: space-between;\n            }\n            .cd-count-item {\n                display: flex;\n                flex-direction: row;\n                align-items: center;\n                height: 24px;\n            }\n            .cd-item-name {\n                font-size: 14px;\n                margin-right: 0.8rem;\n                white-space: nowrap;\n            }\n            .cd-item-progress {\n                position: relative;\n                display: flex;\n                flex-direction: row;\n                align-items: center;\n                justify-content: space-between;\n                height: 100%;\n                width: 100%;\n                border-radius: 8px;\n                background-color: var(--anzhiyu-background);\n                overflow: hidden;\n            }\n            .cd-progress-bar {\n                height: 100%;\n                border-radius: 8px;\n                background-color: var(--anzhiyu-main);\n            }\n            .cd-percentage,\n            .cd-remaining {\n                position: absolute;\n                font-size: 12px;\n                margin: 0 6px;\n                transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;\n            }\n            .cd-many {\n                color: #fff;\n            }\n            .cd-percentage {\n                opacity: 0;\n                transform: translateX(10px);\n            }\n            .card-countdown .item-content:hover .cd-percentage {\n                transform: translateX(0);\n                opacity: 1;\n            }\n            .card-countdown .item-content:hover .cd-remaining {\n                transform: translateX(-10px);\n                opacity: 0;\n            }\n        ',document.head.appendChild(e)}(),i(),o=setInterval(i,6e5)};return["pjax:complete","DOMContentLoaded"].forEach((e=>document.addEventListener(e,r))),document.addEventListener("pjax:send",(()=>o&&clearInterval(o))),{start:r,stop:()=>o&&clearInterval(o),getNextFestival:n}})();