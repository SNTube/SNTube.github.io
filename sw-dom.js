document.addEventListener("DOMContentLoaded",(()=>{if(!navigator.serviceWorker?.controller)return;const e=e=>{const t=e.endsWith("js")?"script":"link",n="link"===t?"href":"src";for(let o of document.getElementsByTagName(t)){const r=o[n];if(e.length>r?e.endsWith(r):r.endsWith(e)){const e=document.createElement(t),n=o.text||o.textContent||o.innerHTML||"";return Array.from(o.attributes).forEach((t=>e.setAttribute(t.name,t.value))),e.appendChild(document.createTextNode(n)),o.parentNode.replaceChildren(e,o),!0}}},t="updated";var n;sessionStorage.getItem(t)?(sessionStorage.removeItem(t),caches.match("https://id.v3/").then((function(e){e?e.json().then((function(e){anzhiyuPopupManager&&anzhiyuPopupManager.enqueuePopup("通知📢",`已刷新缓存，更新为${e.global+"."+e.local}版本最新内容`,null,5e3)})):console.info("未找到匹配的缓存响应")})).catch((function(e){console.error("缓存匹配出错:",e)}))):(n="update",navigator.serviceWorker.controller.postMessage(n)),navigator.serviceWorker.addEventListener("message",(n=>{sessionStorage.setItem(t,"1");const o=n.data;switch(o.type){case"update":const t=o.list;t&&window.Pjax?.isSupported()&&t.filter((e=>/\.(js|css)$/.test(e))).forEach(e),location.reload();break;case"escape":location.reload()}}))}));